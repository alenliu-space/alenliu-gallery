<div class="mb-16 mt-8 sm:px-6">
  <div class="fj-gallery" style="visibility: hidden;">
    {{ $photos := sort (.Resources.ByType "image") (index .Params "sort_by" | default "Name") (.Params.sort_order | default "asc") }}

    {{ range $index, $original := $photos }}
      {{ if eq $original.ResourceType "image" }}

        {{/* 只允许 Hugo 稳定支持的格式 */}}
        {{ $ext := lower $original.MediaType.SubType }}
        {{ if in (slice "jpg" "jpeg" "png" "webp" "gif") $ext }}

          {{/* 生成缩略图与大图，如果失败则跳过 */}}
          {{ $thumb := $original.Resize "800x webp" }}
          {{ $full := $original.Resize "1600x webp" }}

          {{ if and $thumb $full }}
            <a
              class="fj-gallery-item cursor-zoom-in"
              href="{{ $original.RelPermalink }}"
              data-pswp-src="{{ $full.RelPermalink }}"
              data-pswp-width="{{ $full.Width }}"
              data-pswp-height="{{ $full.Height }}"
              itemscope
              itemtype="https://schema.org/ImageObject"
              style="aspect-ratio: {{ $thumb.Width }} / {{ $thumb.Height }}"
            >
              <img
                class="lazyload"
                width="{{ $thumb.Width }}"
                height="{{ $thumb.Height }}"
                data-src="{{ $thumb.RelPermalink }}"
                alt=""
              />
              <meta itemprop="contentUrl" content="{{ $original.RelPermalink }}" />
            </a>
          {{ end }}

        {{ end }}

      {{ end }}
    {{ end }}
  </div>
</div>
